import "./wasm_exec.cjs";
import { readFileSync } from "fs";
import { ECPair, networks } from "liquidjs-lib";

const WASM_URL = "src/main.wasm";

// @ts-ignore
const go = new Go();
console.log(go);

const mod = WebAssembly.compile(readFileSync(WASM_URL));

async function run() {
  const inst = await WebAssembly.instantiate(await mod, go.importObject);
  go.run(inst);

  const { publicKey } = ECPair.makeRandom({ network: networks.regtest });
  // @ts-ignore
  const claimScript = getPeginAddress(
    publicKey.toString("hex"),
    "745c87635b21020e0338c96a8870479f2396c373cc7696ba124e8635d41b0ea581112b678172612102675333a4e4b8fb51d9d4e22fa5a8eaced3fdac8a8cbf9be8c030f75712e6af992102896807d54bc55c24981f24a453c60ad3e8993d693732288068a23df3d9f50d4821029e51a5ef5db3137051de8323b001749932f2ff0d34c82e96a2c2461de96ae56c2102a4e1a9638d46923272c266631d94d36bdb03a64ee0e14c7518e49d2f29bc40102102f8a00b269f8c5e59c67d36db3cdc11b11b21f64b4bffb2815e9100d9aa8daf072103079e252e85abffd3c401a69b087e590a9b86f33f574f08129ccbd3521ecf516b2103111cf405b627e22135b3b3733a4a34aa5723fb0f58379a16d32861bf576b0ec2210318f331b3e5d38156da6633b31929c5b220349859cc9ca3d33fb4e68aa08401742103230dae6b4ac93480aeab26d000841298e3b8f6157028e47b0897c1e025165de121035abff4281ff00660f99ab27bb53e6b33689c2cd8dcd364bc3c90ca5aea0d71a62103bd45cddfacf2083b14310ae4a84e25de61e451637346325222747b157446614c2103cc297026b06c71cbfa52089149157b5ff23de027ac5ab781800a578192d175462103d3bde5d63bdb3a6379b461be64dad45eabff42f758543a9645afd42f6d4248282103ed1e8d5109c9ed66f7941bc53cc71137baa76d50d274bda8d5e8ffbd6e61fe9a5f6702c00fb275522103aab896d53a8e7d6433137bbba940f9c521e085dd07e60994579b64a6d992cf79210291b7d0b1b692f8f524516ed950872e5da10fb1b808b5a526dedc6fed1cf29807210386aa9372fbab374593466bc5451dc59954e90787f08060964d95c87ef34ca5bb5368ae",
    1,
    true,
    "745c87635b2103e67a1d3ca7d1dbf4c134ed3a1892f86db8235d45489961c47643c0e4916078bc21036132d580b3a0205d01873f6a1495f3ef24f6be3bad408e2c340e746cd9bc7836210260440b2b19a7ccb64b21089a542f34c7a2a08295772145acf4c06ef5c88be43e210248eb7484415570080e167f86f93fe3f7b2527c4c9848025bbf3ec7647fc218612103ca7489507aaa82a0e01af1fe9d065efd1646b8f5b664a2750639537600a78816210352049af330e49d9c1ac0f9c2b8256371ec1f2f3e9bfe77b41e541d5659e246512102af50adf71081e53d4db3764095d17a70b0520507026359bf9c0abc7c1fb99605210303d4978a7f1035feb7627f1dad0ad0ad42130641afcde19c768930ed997cd4e321030d82efb181bbeef0c81cd03f0e4f9b40f57ba6fa4f84214d65e3e18889ee2b6b210308c79da16b9b16c23a9093b68aa043d717c96e1d1b74673a847510f7ed044a48210290bfd959fed4502d367d1198da0383052d68110aa40fe61e55f3573166df1ad62103261130cbeb7efcad340d06dd90ee8c2849113e4faa02e0ac28064eb4dfb9dce62102180a7d96f8a040fd647f6b4a3981792c2fa165a784793dc15e9abbbe7edf547f21022b92fe69c0ee97d1e218ab79b72f2173686ccf7dc73989e724a9960a3835f2fb21038e9fe8af74632af44d5d57f20116ee735053eaeda787a3b7a560d9c6486dbf205f6702c00fb275522103aab896d53a8e7d6433137bbba940f9c521e085dd07e60994579b64a6d992cf79210291b7d0b1b692f8f524516ed950872e5da10fb1b808b5a526dedc6fed1cf29807210386aa9372fbab374593466bc5451dc59954e90787f08060964d95c87ef34ca5bb5368ae"
  );
  console.log(claimScript);
  console.log("done");
}

run().catch(console.error);
